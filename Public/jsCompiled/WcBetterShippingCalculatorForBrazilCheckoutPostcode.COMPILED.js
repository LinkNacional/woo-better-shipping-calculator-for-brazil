/*! For license information please see WcBetterShippingCalculatorForBrazilCheckoutPostcode.COMPILED.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,o,a){var i=r&&r.prototype instanceof l?r:l,u=Object.create(i.prototype);return c(u,"_invoke",function(n,r,o){var c,a,i,l=0,u=o||[],h=!1,d={p:0,n:0,v:e,a:b,f:b.bind(e,4),d:function(t,n){return c=t,a=0,i=e,d.n=n,s}};function b(n,r){for(a=n,i=r,t=0;!h&&l&&!o&&t<u.length;t++){var o,c=u[t],b=d.p,p=c[2];n>3?(o=p===r)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=e):c[0]<=b&&((o=n<2&&b<c[1])?(a=0,d.v=r,d.n=c[1]):b<p&&(o=n<3||c[0]>r||r>p)&&(c[4]=n,c[5]=r,d.n=p,a=0))}if(o||n>1)return s;throw h=!0,r}return function(o,u,p){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&b(u,p),a=u,i=p;(t=a<2?e:i)||!h;){c||(a?a<3?(a>1&&(d.n=-1),b(a,i)):d.n=i:d.v=i);try{if(l=2,c){if(a||(o="next"),t=c[o]){if(!(t=t.call(c,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,a<2&&(a=0)}else 1===a&&(t=c.return)&&t.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=e}else if((t=(h=d.n<0)?i:n.call(r,d))!==s)break}catch(t){c=e,a=1,i=t}finally{l=1}}return{value:t,done:h}}}(n,o,a),!0),u}var s={};function l(){}function u(){}function h(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(c(t={},r,function(){return this}),t),b=h.prototype=l.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e}return u.prototype=h,c(b,"constructor",h),c(h,"constructor",u),u.displayName="GeneratorFunction",c(h,a,"GeneratorFunction"),c(b),c(b,a,"Generator"),c(b,r,function(){return this}),c(b,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:p}})()}function c(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,r){function a(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},c(e,t,n,r)}function a(e,t,n,r,o,c,a){try{var i=e[c](a),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var c=e.apply(t,n);function i(e){a(c,r,o,i,s,"next",e)}function s(e){a(c,r,o,i,s,"throw",e)}i(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}jQuery(function(e){function t(t){var n=e("#wc-better-checkbox-"+t),r=n.closest("label");n.prop("disabled",!0).addClass("wc-better-checkbox-disabled").prop("checked",!1),r.addClass("wc-better-checkbox-disabled-label")}var r=!0;function c(t){var n=e("#wc-better-checkbox-"+t).closest(".wc-block-components-checkbox"),r=e("#"+t+"-country");r.length&&n.length&&("BR"!==r.val()?n.css("display","none"):n.css("display",""))}"undefined"!=typeof wc_better_checkout_vars&&"no"===wc_better_checkout_vars.fill_checkout_address&&(r=!1);var a=function(){return t=function t(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"shipping";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.input=e(n),this.checkboxLabel=e(r),this.context=o,this.addressData=null,this.checkboxInput=null,this._abortController=null,this._lastCep="",this.init()},c=[{key:"formatCep",value:function(e){return 8===(e=this.sanitizeCep(e)).length?e.slice(0,5)+"-"+e.slice(5):e}},{key:"init",value:function(){if(this.input.length){this.input.on("input",this.handleInput.bind(this)),this.checkboxInput=this.checkboxLabel.find('input[type="checkbox"]'),this.checkboxInput.on("change",this.handleCheckboxChange.bind(this));var e=this.sanitizeCep(this.input.val());this.isValidCep(e)&&this.handleInput({target:{value:e}})}}},{key:"handleCheckboxChange",value:(d=i(o().m(function t(n){var c,a,i,s,l,u,h,d,b,p,f,w=this;return o().w(function(t){for(;;)switch(t.n){case 0:if(r){t.n=1;break}return t.a(2);case 1:if(n.target.checked){t.n=2;break}return t.a(2);case 2:if(n.target.checked&&((c=e(n.target)).prop("disabled",!0).addClass("wc-better-checkbox-disabled"),c.closest("label").addClass("wc-better-checkbox-disabled-label")),a=this.context+"-number",(i=e("#"+a)).length&&(i.val("").prop("disabled",!1).removeAttr("style").trigger("change"),i.parent().removeClass("is-active"),s="wc-"+this.context+"-better-checkbox",(l=e("#"+s)).length&&l.prop("checked",!1).trigger("change")),this.addressData){t.n=3;break}return t.a(2);case 3:return this.showInsertingLabel(),u=this.addressData,h={action:"wc_better_insert_address",address:u.address,city:u.city,state:u.state,district:u.district,postcode:this.formatCep(this.input.val()),context:this.context,nonce:"undefined"!=typeof wc_better_checkout_vars?wc_better_checkout_vars.nonce:""},d=!1,b=new Promise(function(t,n){e.ajax({url:"undefined"!=typeof wc_better_checkout_vars&&wc_better_checkout_vars.ajax_url?wc_better_checkout_vars.ajax_url:"/wp-admin/admin-ajax.php",method:"POST",data:h,success:function(e){d=!0,t(e)},error:function(){d=!0,n()}})}),t.n=4,Promise.race([b,new Promise(function(e){return setTimeout(e,2e3)})]);case 4:if(d){t.n=5;break}return t.n=5,b;case 5:if(this.showInsertedLabel(u),window.wp&&window.wp.data&&"function"==typeof window.wp.data.dispatch)try{window.wp.data.dispatch("wc/store/cart").invalidateResolutionForStore("shippingAddress"),new MutationObserver(function(e,t){var n,r;document.getElementById("".concat(w.context,"-address_1"))&&(n=w.context,r=h,[{id:"".concat(n,"-address_1"),key:"address"},{id:"".concat(n,"-address_2"),key:"address_2"},{id:"".concat(n,"-city"),key:"city"},{id:"".concat(n,"-state"),key:"state"}].forEach(function(e){var t=document.getElementById(e.id);if(t){var n=r[e.key];"state"===e.key?(t.value="SP",t.dispatchEvent(new Event("change",{bubbles:!0}))):""!==n&&null!=n||(Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(t,""),t.dispatchEvent(new Event("input",{bubbles:!0})))}}),clearTimeout(p),p=setTimeout(function(){t.disconnect()},3e3))}).observe(document.body,{childList:!0,subtree:!0})}catch(e){this.checkboxLabel.length&&(f=this.checkboxLabel.find(".wc-block-components-checkbox__label")).stop(!0,!0).fadeOut(150,function(){f.text("Não foi possivel inserir o endereço, preencha os dados abaixo ou tente novamente.").fadeIn(150)})}case 6:return t.a(2)}},t,this)})),function(e){return d.apply(this,arguments)})},{key:"showInsertingLabel",value:function(){if(this.checkboxLabel.length){this._loadingPulse&&(clearInterval(this._loadingPulse),this._loadingPulse=null);var e=this.checkboxLabel.find(".wc-block-components-checkbox__label");e.stop(!0,!0).css("opacity",1).text("Inserindo Endereço...").show(),this._loadingPulse=setInterval(function(){e.fadeOut(350,function(){e.fadeIn(350)})},350)}}},{key:"showInsertedLabel",value:function(e){if(this.checkboxLabel.length){this._loadingPulse&&(clearInterval(this._loadingPulse),this._loadingPulse=null);var t=this.checkboxLabel.find(".wc-block-components-checkbox__label"),n=[];e.address&&n.push(e.address),e.city&&n.push(e.city),e.district&&n.push(e.district),e.state&&n.push(e.state);var r="Endereço inserido: ".concat(n.join(" - "));t.stop(!0,!0).css("opacity",1).text(r).show()}}},{key:"handleInput",value:(h=i(o().m(function t(r){var c,a,s,l,u,h,d,b,p,f,w=this;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(c=this.sanitizeCep(r.target.value),a=this.checkboxLabel.find('input[type="checkbox"]'),s=a.closest("label"),this._abortController&&this._abortController.abort(),this._abortController=null,this._lastCep=c,this._loadingPulse&&(clearInterval(this._loadingPulse),this._loadingPulse=null),this.checkboxLabel&&this.checkboxLabel.length&&this.checkboxLabel.find(".wc-block-components-checkbox__label").stop(!0,!0).css("opacity",1).show(),!this.isValidCep(c)){t.n=8;break}return a.prop("disabled",!0),a.addClass("wc-better-checkbox-disabled"),s.addClass("wc-better-checkbox-disabled-label"),this.showLoadingLabel(),l=new AbortController,this._abortController=l,t.p=1,t.n=2,Promise.race([i(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,w.fetchAddress(c,l.signal);case 1:u=e.v;case 2:return e.a(2)}},e)}))(),new Promise(function(e){return setTimeout(e,2e3)})]);case 2:if(void 0!==u){t.n=4;break}return t.n=3,this.fetchAddress(c,l.signal);case 3:u=t.v;case 4:t.n=6;break;case 5:if(t.p=5,"AbortError"!==t.v.name){t.n=6;break}return t.a(2);case 6:if(this._lastCep===c){t.n=7;break}return t.a(2);case 7:if(u)h=this.addressData,d=h&&h._rawCep?h._rawCep:null,b=this.input.val(),this.addressData=n(n({},u),{},{_rawCep:b}),this.updateCheckboxLabel(u),a.prop("disabled",!1),a.removeClass("wc-better-checkbox-disabled"),s.removeClass("wc-better-checkbox-disabled-label"),h&&JSON.stringify(h)===JSON.stringify(u)&&d===b||a.prop("checked")&&this.handleCheckboxChange({target:a[0]});else if(this.addressData=null,this.showNotFoundLabel(),a.prop("disabled",!0),a.addClass("wc-better-checkbox-disabled"),s.addClass("wc-better-checkbox-disabled-label"),a.prop("checked",!1),p={action:"wc_better_insert_address",address:"",city:"",state:"",district:"",postcode:this.formatCep(this.input.val()),context:this.context,not_found:!0,nonce:"undefined"!=typeof wc_better_checkout_vars?wc_better_checkout_vars.nonce:""},e.ajax({url:"undefined"!=typeof wc_better_checkout_vars&&wc_better_checkout_vars.ajax_url?wc_better_checkout_vars.ajax_url:"/wp-admin/admin-ajax.php",method:"POST",data:p}),window.wp&&window.wp.data&&"function"==typeof window.wp.data.dispatch)try{window.wp.data.dispatch("wc/store/cart").invalidateResolutionForStore("shippingAddress")}catch(e){this.checkboxLabel.length&&(f=this.checkboxLabel.find(".wc-block-components-checkbox__label")).stop(!0,!0).fadeOut(150,function(){f.text("Não foi possivel atualizar o endereço, tente novamente.").fadeIn(150)})}t.n=9;break;case 8:a.prop("disabled",!0),a.addClass("wc-better-checkbox-disabled"),s.addClass("wc-better-checkbox-disabled-label"),a.prop("checked",!1),this.checkboxLabel.length&&this.checkboxLabel.find(".wc-block-components-checkbox__label").text("Informe acima o código Postal (CEP).");case 9:return t.a(2)}},t,this,[[1,5]])})),function(e){return h.apply(this,arguments)})},{key:"showLoadingLabel",value:function(){if(this.checkboxLabel.length){this._loadingPulse&&(clearInterval(this._loadingPulse),this._loadingPulse=null);var e=this.checkboxLabel.find(".wc-block-components-checkbox__label");e.stop(!0,!0).css("opacity",1).text("Carregando Endereço...").show(),this._loadingPulse=setInterval(function(){e.fadeOut(350,function(){e.fadeIn(350)})},350)}}},{key:"showNotFoundLabel",value:function(){if(this.checkboxLabel.length){this._loadingPulse&&(clearInterval(this._loadingPulse),this._loadingPulse=null);var e=this.checkboxLabel.find(".wc-block-components-checkbox__label");e.stop(!0,!0).css("opacity",1).fadeOut(150,function(){e.text("Não encontramos o endereço, preencha os dados abaixo.").fadeIn(150)})}}},{key:"sanitizeCep",value:function(e){return e.replace(/\D/g,"")}},{key:"isValidCep",value:function(e){return/^\d{8}$/.test(e)}},{key:"fetchAddress",value:(u=i(o().m(function e(t,n){var r;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.fetchFromBrasilApi(t,n);case 1:if(r=e.v){e.n=3;break}return e.n=2,this.fetchFromViaCep(t,n);case 2:r=e.v;case 3:return e.a(2,r)}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"fetchFromBrasilApi",value:(l=i(o().m(function e(t,n){var r,c,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("https://brasilapi.com.br/api/cep/v2/".concat(t),{signal:n});case 1:if((r=e.v).ok){e.n=2;break}return e.a(2,null);case 2:return e.n=3,r.json();case 3:if(!(c=e.v).cep){e.n=4;break}return e.a(2,{city:c.city,state:c.state,address:c.street,district:c.neighborhood||""});case 4:e.n=7;break;case 5:if(e.p=5,"AbortError"!==(a=e.v).name){e.n=6;break}throw a;case 6:case 7:return e.a(2,null)}},e,null,[[0,5]])})),function(e,t){return l.apply(this,arguments)})},{key:"fetchFromViaCep",value:(a=i(o().m(function e(t,n){var r,c,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("https://viacep.com.br/ws/".concat(t,"/json/"),{signal:n});case 1:if((r=e.v).ok){e.n=2;break}return e.a(2,null);case 2:return e.n=3,r.json();case 3:if(!(c=e.v).cep){e.n=4;break}return e.a(2,{city:c.localidade,state:c.uf,address:c.logradouro,district:c.bairro||""});case 4:e.n=7;break;case 5:if(e.p=5,"AbortError"!==(a=e.v).name){e.n=6;break}throw a;case 6:case 7:return e.a(2,null)}},e,null,[[0,5]])})),function(e,t){return a.apply(this,arguments)})},{key:"updateCheckboxLabel",value:function(e){if(this.checkboxLabel.length){this._loadingPulse&&clearInterval(this._loadingPulse);var t=this.checkboxLabel.find(".wc-block-components-checkbox__label"),n=[];e.address&&n.push(e.address),e.city&&n.push(e.city),e.district&&n.push(e.district),e.state&&n.push(e.state);var r="Usar o endereço: ".concat(n.join(" - "));t.stop(!0,!0).text(r).show()}}}],c&&s(t.prototype,c),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,c,a,l,u,h,d}();new MutationObserver(function(){e(".wc-block-components-address-form__postcode").each(function(){var n=e(this);n.css("flex","1 0 calc(100%)");var o=n.find("input");if(0!==o.length){var i=o.attr("id").replace("-postcode",""),s="woo-better-priority-"+i;if(!n.hasClass(s)){n.addClass(s);var l=e('label[for="wc-better-checkbox-'+i+'"]'),u=e("#"+i+"-address_1"),h=u.length?u.parent():null;if(l.length){var d=l.closest(".wc-block-components-checkbox");d.length&&d.prev()[0]!==n[0]&&n.insertBefore(d)}else h&&h.prev()[0]!==n[0]&&n.insertBefore(h);var b=window.wc_better_checkout_vars&&window.wc_better_checkout_vars.billing_number||"",p=window.wc_better_checkout_vars&&window.wc_better_checkout_vars.shipping_number||"",f="billing"===i?b:p;if(f&&u.length){var w=u.val(),v=new RegExp("\\s*[–-]\\s*"+f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\s*$","i"),k=w.replace(v,"");Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(u[0],k),u[0].dispatchEvent(new Event("input",{bubbles:!0}))}0===l.length&&function(n){if(r){var o=e("#"+n+"-postcode");if(0!==o.length){o.parent();var c="wc-better-checkbox-"+n,i=e("#"+c).closest(".wc-block-components-checkbox");if(i.length)return o.parent().next().is(i)||i.insertAfter(o.parent()),void t(n);var s=e("<div>",{class:"wc-block-components-checkbox wc-block-checkout__use-address-for-shipping wc-better"}),l=e("<label>",{for:c}),u=e("<input>",{id:c,class:"wc-block-components-checkbox__input wc-better-checkbox-disabled",type:"checkbox","aria-invalid":"false",checked:!1,disabled:!0}),h=e('<svg class="wc-block-components-checkbox__mark" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 20"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"></path></svg>'),d=e("<span>",{class:"wc-block-components-checkbox__label",text:"Informe acima o código postal (CEP)"});l.append(u,h,d),s.append(l),s.insertAfter(o.parent()),new a("#"+n+"-postcode",'label[for="'+c+'"]',n),t(n)}}}(i),c(i);var _=e("#"+i+"-country");_.length&&_.off("change.wcBetterCountry").on("change.wcBetterCountry",function(){c(i)})}}})}).observe(document.body,{childList:!0,subtree:!0})})})();