/*! For license information please see WcBetterShippingCalculatorForBrazilPublicGutenbergCEPField.COMPILED.js.LICENSE.txt */
(()=>{function e(){var n,o,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function s(e,r,i,c){var s=r&&r.prototype instanceof l?r:l,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,r){var i,c,s,l=0,u=r||[],d=!1,p={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(e,t){return i=e,c=0,s=n,p.n=t,a}};function f(e,t){for(c=e,s=t,o=0;!d&&l&&!r&&o<u.length;o++){var r,i=u[o],f=p.p,b=i[2];e>3?(r=b===t)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=n):i[0]<=f&&((r=e<2&&f<i[1])?(c=0,p.v=t,p.n=i[1]):f<b&&(r=e<3||i[0]>t||t>b)&&(i[4]=e,i[5]=t,p.n=b,c=0))}if(r||e>1)return a;throw d=!0,t}return function(r,u,b){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,b),c=u,s=b;(o=c<2?n:s)||!d;){i||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,i){if(c||(r="next"),o=i[r]){if(!(o=o.call(i,s)))throw TypeError("iterator result is not an object");if(!o.done)return o;s=o.value,c<2&&(c=0)}else 1===c&&(o=i.return)&&o.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);i=n}else if((o=(d=p.n<0)?s:e.call(t,p))!==a)break}catch(e){i=n,c=1,s=e}finally{l=1}}return{value:o,done:d}}}(e,i,c),!0),u}var a={};function l(){}function u(){}function d(){}o=Object.getPrototypeOf;var p=[][i]?o(o([][i]())):(t(o={},i,function(){return this}),o),f=d.prototype=l.prototype=Object.create(p);function b(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,c,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,t(f,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,c,"GeneratorFunction"),t(f),t(f,c,"Generator"),t(f,i,function(){return this}),t(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:b}})()}function t(e,n,o,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,n,o,r){function c(n,o){t(e,n,function(e){return this._invoke(n,o,e)})}n?i?i(e,n,{value:o,enumerable:!r,configurable:!r,writable:!r}):e[n]=o:(c("next",0),c("throw",1),c("return",2))},t(e,n,o,r)}function n(e,t,n,o,r,i,c){try{var s=e[i](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(o,r)}function o(e){return function(){var t=this,o=arguments;return new Promise(function(r,i){var c=e.apply(t,o);function s(e){n(c,r,i,s,a,"next",e)}function a(e){n(c,r,i,s,a,"throw",e)}s(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var t=null,n=!1,r="",i=!1,c=null,s=null,a=!1,l="",u=null,d=!1,p=1,f=null,b="",v="",y="",m=null,w=null,h=0,k=function(e){e.preventDefault(),alert("Verifique as opções de entrega");var t=document.querySelector(".wc-block-components-button.wp-element-button.wc-block-cart__submit-button.contained"),n=t.querySelector(".wc-block-components-spinner"),o=t.querySelector(".wc-block-components-button__text");n&&(n.style.visibility="visible"),o&&(o.style.visibility="hidden"),setTimeout(function(){var e=t.querySelector(".wc-block-components-spinner"),n=t.querySelector(".wc-block-components-button__text");n&&(n.style.visibility="visible"),e&&(e.style.visibility="hidden")},1e3)};function g(e){return _.apply(this,arguments)}function _(){return _=o(e().m(function t(n){var o,i,a,u,p;return e().w(function(e){for(;;)switch(e.n){case 0:if(o=document.querySelector(".wc-block-components-text-input.wc-block-components-address-form__postcode"),i=o?o.querySelector("input"):null,"undefined"==typeof WooBetterData||"no"!==WooBetterData.wooHiddenAddress){e.n=1;break}if(!(a=document.querySelector(".wc-block-components-text-input.wc-block-components-address-form__city"))){e.n=1;break}if(!(u=a.querySelector("input"))||""!==u.value){e.n=1;break}return alert("Campo cidade vazio"),u.focus(),e.a(2);case 1:if(m instanceof MutationObserver&&m.disconnect(),m=null,w=null,n&&i&&(E(n),n.removeEventListener("click",k),n.addEventListener("click",k)),"undefined"==typeof WooBetterData||"woo-block"!==WooBetterData.wooVersion){e.n=2;break}s=document.querySelector(".wc-block-components-totals-shipping-address-summary"),e.n=3;break;case 2:if("undefined"==typeof WooBetterData||"woo-class"!==WooBetterData.wooVersion){e.n=3;break}return e.n=3,W();case 3:s&&((p=document.querySelector(".wc-block-components-totals-shipping-panel"))&&(c=p.querySelector(".wc-block-components-panel__button-icon"))&&c.addEventListener("click",T,!0),q(i.value)?(l=i.value,i.value!==r?(d=!1,s.addEventListener("click",T,!0),s.classList.add("lkn-wc-shipping-address-summary"),s.style.position="relative",s.classList.add("loading"),s.querySelector(".spinner")||s.insertAdjacentHTML("beforeend",'<span class="spinner is-active"></span>'),w=setInterval(function(){x()},5e3)):x()):(alert("CEP inválido."),s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0)));case 4:return e.a(2)}},t)})),_.apply(this,arguments)}function S(e){if(e){e.classList.remove("lkn-wc-shipping-address-summary"),e.classList.remove("loading");var t=e.querySelector(".spinner");t&&t.remove()}}function E(e){e.setAttribute("disabled","true"),e.style.opacity="0.5"}function L(e){e.removeAttribute("disabled"),e.removeEventListener("click",k),e.style.opacity="1"}function q(e){return/^[0-9]{5}-?[0-9]{3}$/.test(e)}function T(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}function A(){return A=o(e().m(function t(){var n;return e().w(function(t){for(;;)switch(t.n){case 0:n=window.fetch,window.fetch=function(){var t=o(e().m(function t(r,i){var u,m,h,k,g,_,E,L,A;return e().w(function(t){for(;;)switch(t.n){case 0:if(!r.includes("/wp-json/wc/store/v1/batch")){t.n=2;break}if(l||(u=document.querySelector(".wc-block-components-text-input.wc-block-components-address-form__postcode"))&&(m=u?u.querySelector("input"):null)&&(l=m.value),!q(l)){t.n=1;break}if(w&&(clearInterval(w),w=null),(h=document.querySelector(".wc-block-components-totals-shipping-panel"))&&(c=h.querySelector(".wc-block-components-panel__button-icon"))&&c.addEventListener("click",T,!0),d){t.n=1;break}return d=!0,"",k="undefined"!=typeof wpApiSettings&&wpApiSettings.root?wpApiSettings.root+"lknwcbettershipping/v1/cep/?postcode=".concat(l):"undefined"!=typeof WooBetterData&&""!==WooBetterData.wooUrl?WooBetterData.wooUrl+"/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(l):"/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(l),g=new AbortController,_=setTimeout(function(){return g.abort()},1e4),t.n=1,fetch(k,{method:"GET",signal:g.signal,headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){clearTimeout(_),!0===e.status?i&&i.body&&(b=e.address||"",v=e.state_sigla||"",y=e.city||""):(alert("Erro: "+e.message),a=!0,S(s),s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0))}).catch(function(e){clearTimeout(_),"AbortError"===e.name?alert("Erro: Tempo limite de resposta excedido."):console.error(e),S(s),s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0)});case 1:try{E=JSON.parse(i.body),(L=E.requests.find(function(e){return"/wc/store/v1/cart/update-customer"===e.path}))&&("yes"!==WooBetterData.wooHiddenAddress||a||(L.data.shipping_address.address_1=b,L.body.shipping_address.address_1=b,L.data.billing_address||(L.data.billing_address={},L.body.billing_address={},L.data.billing_address.postcode=l,L.body.billing_address.postcode=l),L.data.billing_address.address_1=b,L.body.billing_address.address_1=b),"yes"===WooBetterData.wooHiddenAddress&&(L.data.shipping_address.state=v,L.body.shipping_address.state=v,L.data.billing_address.state=v,L.body.billing_address.state=v),"yes"===WooBetterData.wooHiddenAddress&&(L.data.shipping_address.city=y,L.body.shipping_address.city=y,L.data.billing_address.city=y,L.body.billing_address.city=y),i.body=JSON.stringify(E))}catch(e){console.error("Erro ao modificar o body: ",e),s&&(S(s),s.removeEventListener("click",T,!0)),c&&c.removeEventListener("click",T,!0)}return A=n(r,i),t.a(2,A.then(function(){var t=o(e().m(function t(n){return e().w(function(t){for(;;)switch(t.n){case 0:if(a){t.n=4;break}if(1!==p){t.n=1;break}f=setTimeout(o(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:return p=0,e.n=1,j();case 1:B();case 2:return e.a(2)}},t)})),4e3),t.n=3;break;case 1:if(!(p>1)){t.n=3;break}return clearTimeout(f),p=0,t.n=2,j();case 2:B();case 3:p++;case 4:return t.a(2,n)}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){throw console.error("Erro na requisição:",e),e}));case 2:return t.a(2,n(r,i))}},t)}));return function(e,n){return t.apply(this,arguments)}}();case 1:return t.a(2)}},t)})),A.apply(this,arguments)}function j(){return D.apply(this,arguments)}function D(){return(D=o(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof WooBetterData||"woo-block"!==WooBetterData.wooVersion){e.n=1;break}s=document.querySelector(".wc-block-components-totals-shipping-address-summary"),e.n=2;break;case 1:if("woo-class"!==WooBetterData.wooVersion){e.n=2;break}return e.n=2,W();case 2:s&&s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0);case 3:return e.a(2)}},t)}))).apply(this,arguments)}function B(){S(s),L(u),b="",v="",y="",f=null}function W(){return O.apply(this,arguments)}function O(){return(O=o(e().m(function t(){return e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){var n=setInterval(function(){var t=document.querySelector(".wc-block-components-shipping-address");t?(s=t,clearInterval(n),e()):h>=40&&(clearInterval(n),e()),h++},100)}))},t)}))).apply(this,arguments)}function x(){return P.apply(this,arguments)}function P(){return(P=o(e().m(function t(){var n,o,r;return e().w(function(e){for(;;)switch(e.n){case 0:return n=new AbortController,o=setTimeout(function(){return n.abort()},15e3),"undefined"!=typeof wpApiSettings&&wpApiSettings.root?apiUrl=wpApiSettings.root+"lknwcbettershipping/v1/cep/?postcode=".concat(l):"undefined"!=typeof WooBetterData&&""!==WooBetterData.wooUrl?apiUrl=WooBetterData.wooUrl+"/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(l):apiUrl="/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(l),s.addEventListener("click",T,!0),s.classList.add("lkn-wc-shipping-address-summary"),s.style.position="relative",s.classList.add("loading"),r=s.querySelector(".spinner"),d=!0,r||s.insertAdjacentHTML("beforeend",'<span class="spinner is-active"></span>'),e.n=1,fetch(apiUrl,{method:"GET",signal:n.signal,headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(clearTimeout(o),!0===e.status){var t;b=e.address||"",v=e.state_sigla||"",y=e.city||"";var n="",r="";"undefined"!=typeof wpApiSettings&&null!==(t=wpApiSettings)&&void 0!==t&&t.nonce&&(r=wpApiSettings.nonce),wcBlocksMiddlewareConfig&&(n=wcBlocksMiddlewareConfig.storeApiNonce);var i="";"undefined"!=typeof wpApiSettings&&wpApiSettings.root?i=wpApiSettings.root+"wc/store/v1/batch?_locale=site":(i=window.location.origin+"wp-json/wc/store/v1/batch?_locale=site","undefined"!=typeof WooBetterData&&""!==WooBetterData.wooUrl?apiUrl=WooBetterData.wooUrl+"wp-json/wc/store/v1/batch?_locale=site":apiUrl="/wp-json/wc/store/v1/batch?_locale=site"),fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Nonce:n,"x-wp-nonce":r},body:JSON.stringify({requests:[{method:"POST",path:"/wc/store/v1/cart/update-customer",body:{shipping_address:{postcode:l,address_1:b,state:v,city:y},billing_address:{postcode:l,address_1:b,state:v,city:y}},data:{shipping_address:{postcode:l,address_1:b,state:v,city:y},billing_address:{postcode:l,address_1:b,state:v,city:y}},headers:{Nonce:n},cache:"no-store"}]})})}else alert("Erro: "+e.message),S(s),a=!0,s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0)}).catch(function(e){clearTimeout(o),"AbortError"===e.name?alert("Erro: Tempo limite de resposta excedido."):console.error(e),S(s),s.removeEventListener("click",T,!0),c&&c.removeEventListener("click",T,!0)});case 1:return e.a(2)}},t)}))).apply(this,arguments)}new MutationObserver(o(e().m(function o(){var c,s,a,l;return e().w(function(e){for(;;)switch(e.n){case 0:(c=document.querySelector(".wc-block-components-shipping-address"))||(c=document.querySelector(".wc-block-components-totals-shipping__change-address__link")),s=document.querySelector(".wc-block-components-text-input.wc-block-components-address-form__postcode"),(u=document.querySelector(".wc-block-components-button.wp-element-button.wc-block-cart__submit-button.contained"))||(i=!1),u&&!i&&c&&(i=!0,u.removeEventListener("click",k),u.addEventListener("click",k),E(u)),!c&&u&&L(u),s||(n=!1),s&&!n&&(n=!0,a=document.querySelector(".wc-block-components-shipping-calculator-address__button"),l=s?s.querySelector("input"):null,a&&u&&l&&(r=l.value,t&&a.removeEventListener("click",t),t=function(){return g(u)},a.addEventListener("click",t)));case 1:return e.a(2)}},o)}))).observe(document.body,{childList:!0,subtree:!0}),function(){A.apply(this,arguments)}()})})();