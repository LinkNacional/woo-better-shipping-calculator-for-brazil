document.addEventListener("DOMContentLoaded",function(){var e=!1,t=!1,o=!1,i=null,n=null,r=null,a=null,d=!1,h={billing_neighborhood:"",shipping_neighborhood:""};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"billing",t=document.querySelector("#".concat(e,"-country"))||document.querySelector('select[name="'.concat(e,'_country"]'))||document.querySelector('input[name="'.concat(e,'_country"]'));return!!t&&"BR"===t.value}function l(){return c("billing")||c("shipping")}function s(){var e=document.querySelector(".wc-better-billing-neighborhood"),t=document.querySelector(".wc-better-shipping-neighborhood");e&&e.remove(),t&&t.remove(),d=!1,function(){var e={billing_neighborhood:"",shipping_neighborhood:""};if("undefined"!=typeof wp&&wp.data&&wp.data.dispatch)try{var t=wp.data.dispatch;if(t("wc/store/checkout")){var o=t("wc/store/checkout");o.setExtensionData&&o.setExtensionData("woo_better_neighborhood",e)}}catch(e){}window.wc&&window.wc.blocksCheckout&&"function"==typeof window.wc.blocksCheckout.extensionCartUpdate&&window.wc.blocksCheckout.extensionCartUpdate({namespace:"woo_better_neighborhood",data:e})}()}function u(t){if(c("billing")){var o=document.querySelector('span.wc-block-components-address-card__edit[aria-controls="billing"]');o&&("true"!=o.getAttribute("aria-expanded")&&o.click(),"true"==o.getAttribute("aria-expanded")&&(setTimeout(function(){!function(e){if(!document.getElementById("billing-neighborhood")){var t=e.querySelector("#billing-address_1");if(t){var o="undefined"!=typeof WooBetterNeighborhoodData&&WooBetterNeighborhoodData.billing_neighborhood?WooBetterNeighborhoodData.billing_neighborhood:"";h.billing_neighborhood?o=h.billing_neighborhood:h.billing_neighborhood=o,m(t.parentElement,"billing-neighborhood","Bairro",o),y("billing-neighborhood"),_(!0)}}}(t)},300),e=!0))}}function g(e){if(c("shipping")){var o=document.querySelector('span.wc-block-components-address-card__edit[aria-controls="shipping"]');o&&("true"!=o.getAttribute("aria-expanded")&&o.click(),"true"==o.getAttribute("aria-expanded")&&(setTimeout(function(){!function(e){if(!document.getElementById("shipping-neighborhood")){var t=e.querySelector("#shipping-address_1");if(t){var o="undefined"!=typeof WooBetterNeighborhoodData&&WooBetterNeighborhoodData.shipping_neighborhood?WooBetterNeighborhoodData.shipping_neighborhood:"";h.shipping_neighborhood?o=h.shipping_neighborhood:h.shipping_neighborhood=o,m(t.parentElement,"shipping-neighborhood","Bairro",o),y("shipping-neighborhood"),o&&setTimeout(function(){var e=document.getElementById("shipping-neighborhood");if(e){var t=new Event("input",{bubbles:!0});e.dispatchEvent(t)}},100),_(!0)}}}(e)},300),t=!0))}}function b(e){var t=document.querySelector("#".concat(e,"-country"));t&&(t.dataset.neighborhoodListener||(t.addEventListener("change",function(){console.log("Country changed:",e,"to:",this.value),setTimeout(function(){v()},300)}),t.dataset.neighborhoodListener="true"),"billing"!==e||r?"shipping"!==e||a||(a=p(0,e)):r=p(0,e))}function p(e,t){var o=new MutationObserver(function(e){e.forEach(function(e){"childList"!==e.type&&"attributes"!==e.type||setTimeout(function(){var e=document.querySelector("#".concat(t,"-country"));e&&!e.dataset.neighborhoodListener&&(e.addEventListener("change",function(){setTimeout(function(){v()},300)}),e.dataset.neighborhoodListener="true")},100)})}),i=document.querySelector("#".concat(t));return i&&o.observe(i,{childList:!0,subtree:!0,attributes:!0}),o}function v(){if(console.log("handleCountryChange called. isAnyCountryBrazil:",l()),console.log("billing country BR:",c("billing")),console.log("shipping country BR:",c("shipping")),console.log("neighborhoodFieldsActive:",d),!l())return console.log("Removing all neighborhood fields - no Brazil country"),void(d&&s());if(c("billing")){if(!document.getElementById("billing-neighborhood")){var e=document.querySelector("#billing");e&&u(e)}}else{console.log("Removing billing neighborhood - not Brazil");var t=document.querySelector(".wc-better-billing-neighborhood");t&&t.remove()}if(c("shipping")){if(!document.getElementById("shipping-neighborhood")){var o=document.querySelector("#shipping");o&&g(o)}}else{console.log("Removing shipping neighborhood - not Brazil");var i=document.querySelector(".wc-better-shipping-neighborhood");i&&i.remove()}var n=document.querySelector(".wc-better-billing-neighborhood")||document.querySelector(".wc-better-shipping-neighborhood");d=!!n,console.log("After handleCountryChange, neighborhoodFieldsActive:",d)}function m(e,t,o,i){var n=document.createElement("div");n.className="wc-block-components-text-input wc-block-components-address-form__neighborhood wc-better-"+t.replace("_","-");var r=document.createElement("input");r.type="text",r.id=t,r.name=t,r.setAttribute("autocomplete","address-line2"),r.setAttribute("aria-label",o),r.setAttribute("aria-invalid","false"),r.setAttribute("autocapitalize","words"),r.setAttribute("required","true"),r.value=i,r.setAttribute("title","Digite o nome do bairro");var a=i;r.addEventListener("input",function(){var e=this.value.trim();"billing-neighborhood"===t?h.billing_neighborhood=e:"shipping-neighborhood"===t&&(h.shipping_neighborhood=e),e!==a&&(a=e,_(),e.length>0&&w(this))});var d=document.createElement("label");d.setAttribute("for",t),d.textContent=o,n.appendChild(r),n.appendChild(d);var c=document.createElement("div");c.className="wc-block-components-validation-error wc-better-neighborhood-error",c.setAttribute("role","alert"),c.style.display="none";var l=document.createElement("p");l.id="validate-error-"+t;var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("viewBox","-2 -2 24 24"),s.setAttribute("width","24"),s.setAttribute("height","24"),s.setAttribute("aria-hidden","true"),s.setAttribute("focusable","false");var u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"),s.appendChild(u);var g=document.createElement("span");g.textContent="Por favor, informe o bairro.",l.appendChild(s),l.appendChild(g),c.appendChild(l),n.appendChild(c),i&&n.classList.add("is-active"),r.addEventListener("focus",function(){n.classList.add("is-active")}),r.addEventListener("blur",function(){r.value.trim()?w(r):(n.classList.remove("is-active"),f(r,"Por favor, informe o bairro."))}),e.insertAdjacentElement("afterend",n)}function f(e,t){var o=e.closest(".wc-better-billing-neighborhood, .wc-better-shipping-neighborhood"),i=o?o.querySelector(".wc-better-neighborhood-error"):null;if(i){var n=i.querySelector("span");n&&(n.textContent=t),i.style.display="block"}o&&o.classList.add("has-error")}function w(e){var t=e.closest(".wc-better-billing-neighborhood, .wc-better-shipping-neighborhood"),o=t?t.querySelector(".wc-better-neighborhood-error"):null;o&&(o.style.display="none"),t&&t.classList.remove("has-error")}function y(e){var t=document.getElementById(e);t&&t.setAttribute("required","true")}function _(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l()&&(n&&(clearTimeout(n),n=null),e?E():n=setTimeout(function(){E(),n=null},1500))}function E(){if(l()){var e=document.getElementById("billing-neighborhood"),t=document.getElementById("shipping-neighborhood"),o={billing_neighborhood:e?e.value:"",shipping_neighborhood:t?t.value:""};if("undefined"!=typeof wp&&wp.data&&wp.data.dispatch)try{var i=wp.data.dispatch;if(i("wc/store/checkout")){var n=i("wc/store/checkout");n.setExtensionData&&n.setExtensionData("woo_better_neighborhood",o)}}catch(e){}window.wc&&window.wc.blocksCheckout&&"function"==typeof window.wc.blocksCheckout.extensionCartUpdate&&window.wc.blocksCheckout.extensionCartUpdate({namespace:"woo_better_neighborhood",data:o})}}new MutationObserver(function(n){if(l()){var h=document.querySelector("#billing"),p=document.querySelector("#shipping");h||(e=!1),p||(t=!1),h&&!e&&c("billing")&&u(h),p&&!t&&c("shipping")&&g(p);var v=document.querySelector("#billing-country"),m=document.querySelector("#shipping-country");v&&!r&&b("billing"),m&&!a&&b("shipping");var y=document.querySelector(".wc-block-checkout__actions_row");y&&(i=y.querySelector("button")),i&&!o&&(o=!0,i)&&i.addEventListener("click",function(e){if(l()){var t=document.getElementById("billing-neighborhood"),o=document.getElementById("shipping-neighborhood"),i=!1;return t&&c("billing")&&(t.value.trim().length?w(t):(f(t,"Por favor, informe o bairro de cobranÃ§a."),t.scrollIntoView({behavior:"smooth",block:"center"}),i=!0)),o&&c("shipping")&&(o.value.trim().length?w(o):(f(o,"Por favor, informe o bairro de entrega."),i||o.scrollIntoView({behavior:"smooth",block:"center"}),i=!0)),i?(e.stopPropagation(),void e.preventDefault()):void 0}})}else d&&s()}).observe(document.body,{childList:!0,subtree:!0}),function(){if(l()&&"undefined"!=typeof wp&&wp.data&&wp.data.dispatch)try{var e=wp.data,t=e.dispatch,o=e.select;if(t("wc/store/checkout")){var i=t("wc/store/checkout");if(i.setExtensionData){var n=(o("wc/store/checkout").getExtensionData()||{}).woo_better_neighborhood||{},r="undefined"!=typeof WooBetterNeighborhoodData&&WooBetterNeighborhoodData.billing_neighborhood?WooBetterNeighborhoodData.billing_neighborhood:"",a="undefined"!=typeof WooBetterNeighborhoodData&&WooBetterNeighborhoodData.shipping_neighborhood?WooBetterNeighborhoodData.shipping_neighborhood:"";n.hasOwnProperty("billing_neighborhood")||(n.billing_neighborhood=r),n.hasOwnProperty("shipping_neighborhood")||(n.shipping_neighborhood=a),i.setExtensionData("woo_better_neighborhood",n)}}}catch(e){}}(),new MutationObserver(function(e){var t=!1;e.forEach(function(e){"childList"===e.type&&e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&((e.querySelectorAll?e.querySelectorAll("#billing-neighborhood, #shipping-neighborhood"):[]).length>0||e.id&&("billing-neighborhood"===e.id||"shipping-neighborhood"===e.id))&&(t=!0)})}),t&&setTimeout(function(){_(!0);var e=document.getElementById("billing-neighborhood"),t=document.getElementById("shipping-neighborhood");if(e&&!e.dataset.storeApiListener){var o=e.value;e.addEventListener("input",function(){var e=this.value.trim();e!==o&&(o=e,_(),e.length>0&&w(this))}),e.dataset.storeApiListener="true"}if(t&&!t.dataset.storeApiListener){var i=t.value;t.addEventListener("input",function(){var e=this.value.trim();e!==i&&(i=e,_(),e.length>0&&w(this))}),t.dataset.storeApiListener="true"}},100)}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(function(){if(l()){_(!0);var e=document.getElementById("billing-neighborhood"),t=document.getElementById("shipping-neighborhood");if(e&&!e.dataset.storeApiListener){var o=e.value;e.addEventListener("input",function(){var e=this.value.trim();e!==o&&(o=e,_(),e.length>0&&w(this))}),e.dataset.storeApiListener="true"}if(t&&!t.dataset.storeApiListener){var i=t.value;t.addEventListener("input",function(){var e=this.value.trim();e!==i&&(i=e,_(),e.length>0&&w(this))}),t.dataset.storeApiListener="true"}}},500)});