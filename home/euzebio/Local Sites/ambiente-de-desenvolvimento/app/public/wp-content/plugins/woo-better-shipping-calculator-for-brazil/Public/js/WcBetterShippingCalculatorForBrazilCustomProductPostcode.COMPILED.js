/*! For license information please see WcBetterShippingCalculatorForBrazilCustomProductPostcode.COMPILED.js.LICENSE.txt */
(()=>{function e(){var n,o,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function i(e,r,a,c){var i=r&&r.prototype instanceof s?r:s,l=Object.create(i.prototype);return t(l,"_invoke",function(e,t,r){var a,c,i,s=0,l=r||[],p=!1,u={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return a=e,c=0,i=n,u.n=t,d}};function m(e,t){for(c=e,i=t,o=0;!p&&s&&!r&&o<l.length;o++){var r,a=l[o],m=u.p,b=a[2];e>3?(r=b===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=m&&((r=e<2&&m<a[1])?(c=0,u.v=t,u.n=a[1]):m<b&&(r=e<3||a[0]>t||t>b)&&(a[4]=e,a[5]=t,u.n=b,c=0))}if(r||e>1)return d;throw p=!0,t}return function(r,l,b){if(s>1)throw TypeError("Generator is already running");for(p&&1===l&&m(l,b),c=l,i=b;(o=c<2?n:i)||!p;){a||(c?c<3?(c>1&&(u.n=-1),m(c,i)):u.n=i:u.v=i);try{if(s=2,a){if(c||(r="next"),o=a[r]){if(!(o=o.call(a,i)))throw TypeError("iterator result is not an object");if(!o.done)return o;i=o.value,c<2&&(c=0)}else 1===c&&(o=a.return)&&o.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),c=1);a=n}else if((o=(p=u.n<0)?i:e.call(t,u))!==d)break}catch(e){a=n,c=1,i=e}finally{s=1}}return{value:o,done:p}}}(e,a,c),!0),l}var d={};function s(){}function l(){}function p(){}o=Object.getPrototypeOf;var u=[][a]?o(o([][a]())):(t(o={},a,function(){return this}),o),m=p.prototype=s.prototype=Object.create(u);function b(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,t(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=p,t(m,"constructor",p),t(p,"constructor",l),l.displayName="GeneratorFunction",t(p,c,"GeneratorFunction"),t(m),t(m,c,"Generator"),t(m,a,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:b}})()}function t(e,n,o,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,o,r){function c(n,o){t(e,n,function(e){return this._invoke(n,o,e)})}n?a?a(e,n,{value:o,enumerable:!r,configurable:!r,writable:!r}):e[n]=o:(c("next",0),c("throw",1),c("return",2))},t(e,n,o,r)}function n(e,t,n,o,r,a,c){try{var i=e[a](c),d=i.value}catch(e){return void n(e)}i.done?t(d):Promise.resolve(d).then(o,r)}document.addEventListener("DOMContentLoaded",function(){var t,o,r,a,c=window.WooBetterData||{},i=!1,d='h1[class*="title"]',s="",l="",p="";function u(e,t,n){var o=document.createElement("img");o.src=c.display_icon[t],o.alt=n,o.classList.add("woo-better-toggle-icon"),o.classList.add(c.iconColor||"black-icon"),e.appendChild(o)}function m(){var t;return t=e().m(function t(n){var o,r;return e().w(function(e){for(;;)switch(e.n){case 0:return o=new AbortController,r=setTimeout(function(){return o.abort()},15e3),"undefined"!=typeof wpApiSettings&&wpApiSettings.root?apiUrl=wpApiSettings.root+"lknwcbettershipping/v1/cep/?postcode=".concat(n):void 0!==c&&""!==c.wooUrl?apiUrl=c.wooUrl+"/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(n):apiUrl="/wp-json/lknwcbettershipping/v1/cep/?postcode=".concat(n),e.n=1,fetch(apiUrl,{method:"GET",signal:o.signal,headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(clearTimeout(r),!0===e.status){if(e.address&&e.state_sigla&&e.city)postcodeError=!1;else{if(postcodeError=!0,addressSummary&&(removeLoading(addressSummary),addressSummary.removeEventListener("click",blockInteraction,!0),iconSummary,iconSummary.removeEventListener("click",blockInteraction,!0)),!e.address)return alert("Erro: Endereço inválido.");if(!e.state_sigla)return alert("Erro: Estado inválido.");if(!e.city)return alert("Erro: Cidade inválida.")}s=n,addressData=e.address,stateData=e.state_sigla,cityData=e.city;var t=c.ajaxurl,o=new FormData;o.append("action","register_product_address"),o.append("product_id",c.product_id),o.append("shipping[address_1]",addressData),o.append("shipping[city]",cityData),o.append("shipping[state]",stateData),o.append("shipping[postcode]",s),o.append("shipping[country]","BR"),fetch(t,{method:"POST",headers:{nonce:c.nonce},body:o}).then(function(e){return e.json()}).then(function(e){if(e.success){var t=document.querySelector(".woo-better-info-block"),o=document.querySelector("#custom-postcode-form");b(e.data,o,t,n).then(function(){var e=document.querySelector(".woo-better-button-current-style"),n=document.querySelector(".woo-better-input-current-style");e.disabled=!1,n.disabled=!1,e.textContent=p;var o=document.querySelector(".woo-better-current-postcode-block");o&&(o.style.display="flex"),t.style.display="block",n.style.backgroundColor=c.inputStyles.backgroundColor||"#fff",n.style.cursor="",e.style.backgroundColor=c.buttonStyles.backgroundColor||"#0073aa",e.style.cursor="";var r=t.querySelector(".woo-better-toggle-button");if(r&&(r.innerHTML="",u(r,"up","Esconder detalhes de entrega")),l){var a=t.querySelector(".woo-better-content-block");a&&(a.classList.add("expanded"),a.style.display="block")}}).catch(function(e){console.error("Erro:",e),alert("Erro: "+e.message||0)})}else console.error("Erro:",e.message)}).catch(function(e){console.error("Erro na requisição:",e)})}else alert("Erro: "+e.message)}).catch(function(e){clearTimeout(r),"AbortError"===e.name?alert("Erro: Tempo limite de resposta excedido."):console.error(e)});case 1:return e.a(2)}},t)}),m=function(){var e=this,o=arguments;return new Promise(function(r,a){var c=t.apply(e,o);function i(e){n(c,r,a,i,d,"next",e)}function d(e){n(c,r,a,i,d,"throw",e)}i(void 0)})},m.apply(this,arguments)}function b(e,t,n,o){return new Promise(function(r,a){try{var c=e;if(!c||!Array.isArray(c.shipping_rates)||0===c.shipping_rates.length)return a("Nenhuma taxa de envio foi encontrada.");var i={postcode:o,timestamp:Date.now()};l=i,localStorage.setItem("woo_better_postcode",JSON.stringify(i)),t.style.display="none";var d=n.querySelector(".woo-better-content-block").querySelector(".woo-better-shipping-list"),s=n.querySelector(".woo-better-product-name");if(s){var p=s.childNodes[1];p&&p.nodeType===Node.TEXT_NODE&&(p.textContent=" Produto: ".concat(c.product.name))}var u=n.querySelector(".woo-better-product-quantity");if(u){var m=u.childNodes[1];m&&m.nodeType===Node.TEXT_NODE&&(m.textContent=" Quantidade: ".concat(c.product.quantity))}d.innerHTML="",c.shipping_rates.forEach(function(e){var t=document.createElement("li"),n=parseFloat(e.cost).toFixed(2).replace(".",",");t.innerHTML="<strong>R$ ".concat(n,"</strong> - ").concat(e.label),d.appendChild(t)}),n.querySelector(".woo-better-current-postcode-text").innerHTML="<strong>CEP</strong>: ".concat(o),r()}catch(e){console.error("Erro ao processar as taxas de envio:",e),a(e)}})}t=document.createElement("style"),r=function(e){e=e.replace("#","");var t=parseInt(e,16),n=(t>>16)-10,o=(t>>8&255)-10,r=(255&t)-10;return n=Math.max(0,Math.min(255,n)),o=Math.max(0,Math.min(255,o)),r=Math.max(0,Math.min(255,r)),"#".concat((n<<16|o<<8|r).toString(16).padStart(6,"0"))}(o=c.inputStyles.backgroundColor||"#ffffff"),a="\n            .woo-better-info-block {\n                color: ".concat(c.inputStyles.color," !important;\n                border-radius: ").concat(c.inputStyles.borderRadius," !important;\n                padding: 0px !important;\n                margin: 20px 0px !important;\n                font-family: 'Poppins', sans-serif !important;\n                font-size: 14px !important;\n            }\n\n            .woo-better-current-postcode-block {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 15px;\n                border: 1px solid #ddd;\n                border-radius: 5px;\n                background-color: ").concat(r," !important;\n            }\n\n            .woo-better-content-block {\n                margin-top: -3px;\n                padding: 0px 20px;\n                background-color: ").concat(o," !important;\n                border: none;\n                height: 0;\n                overflow: hidden;\n                transition: height 0.3s ease;\n                box-shadow: none;\n            }\n\n            .woo-better-content-block.expanded {\n                height: auto; \n                padding: 10px 20px;\n                border-bottom-right-radius: ").concat(c.inputStyles.borderRadius," !important;\n                border-bottom-left-radius: ").concat(c.inputStyles.borderRadius," !important;\n                border: ").concat(c.inputStyles.borderWidth," ").concat(c.inputStyles.borderStyle," ").concat(c.inputStyles.borderColor," !important;\n                border-top: 0px !important;\n            }\n        "),t.appendChild(document.createTextNode(a)),document.head.appendChild(t),new MutationObserver(function(e,t){e.forEach(function(e){if("childList"===e.type){var n=function(){if("custom"!==c.position){var e=c.position||"top";return"middle"===e?d='div[class*="price"], p[class*="price"]':"bottom"===e&&(d='form[class*="cart"]'),d}d=c.custom_position||'h1[class*="title"]'}(),o=document.querySelector(n);if(o&&!i){i=!0;var r=function(){var e=document.createElement("div");return e.classList.add("woo-better-parent-container"),e}(),a=function(){var e=document.createElement("form");e.id="custom-postcode-form",e.style.marginTop="20px",e.style.padding="0px",l&&(e.style.display="none");var t=document.createElement("div");t.classList.add("woo-better-container-current-style");var n=document.createElement("div");n.classList.add("woo-better-input-button-group-current-style");var o=document.createElement("div");o.classList.add("woo-better-input-wrapper-current-style");var r=document.createElement("input");r.type="text",r.name="woo_better_custom_product_postcode",r.placeholder=c.placeholder||"Digite o CEP",r.classList.add("woo-better-input-current-style"),r.autocomplete="postal-code",l&&(r.value=l.postcode||"");var a=c.inputStyles||{};Object.keys(a).forEach(function(e){r.style[e]=a[e]}),r.addEventListener("input",function(e){var t=e.target.value;if((t=t.replace(/[^\d-]/g,"")).includes("-")){var n,o=t.split("-");o.length>2||o[0].length>5?t=o[0].slice(0,5)+"-"+(null===(n=o[1])||void 0===n?void 0:n.slice(0,3)):o[0].length<5&&(t=o[0])}t.length>5&&!t.includes("-")&&(t=t.slice(0,5)+"-"+t.slice(5)),t.length>9&&(t=t.slice(0,9)),e.target.value=t});var i=document.createElement("img");i.src=c.icon,i.alt="Ícone de entrega",i.classList.add("woo-better-icon-current-style"),i.classList.add(c.iconColor||"black-icon"),o.appendChild(r),o.appendChild(i);var d=document.createElement("button");d.type="submit",d.textContent="CONSULTAR",d.classList.add("woo-better-button-current-style");var s=c.buttonStyles||{};Object.keys(s).forEach(function(e){d.style[e]=s[e]}),n.appendChild(o),n.appendChild(d),t.appendChild(n);var u=document.createElement("a");return u.href="https://buscacepinter.correios.com.br/app/endereco/index.php",u.textContent="Não sei meu CEP",u.classList.add("woo-better-link-current-style"),u.target="_blank",t.appendChild(u),e.appendChild(t),e.addEventListener("submit",function(e){e.preventDefault();var t=r.value.trim();if(/^\d{5}-\d{3}$/.test(t)){d.disabled=!0,r.disabled=!0;var n=document.querySelector(".woo-better-info-block");n&&(n.style.display="none"),p=d.textContent,d.textContent="";var o=document.createElement("span");o.classList.add("loading-icon"),d.appendChild(o),r.style.backgroundColor="#f0f0f0",r.style.cursor="not-allowed",d.style.backgroundColor="#ccc",d.style.cursor="not-allowed",function(e){m.apply(this,arguments)}(t)}else alert("Por favor, insira um CEP válido no formato XXXXX-XXX.")}),e}(),s={product:{name:"*******",quantity:c.quantity,currency:"R$",currency_minor_unit:2},shipping_rates:[{id:"**********",label:"***********",cost:12.34}],postcode:"123456-789"},b=function(e,t,n,o){var r=document.createElement("div");r.classList.add("woo-better-info-block"),l||(r.style.display="none");var a=document.createElement("div");a.classList.add("woo-better-content-block"),a.style.display="none";var i=document.createElement("p"),d=document.createElement("img");d.src=c.details_icon.product,d.alt="Produto",d.classList.add("woo-better-icon"),d.classList.add(c.iconColor||"black-icon"),i.appendChild(d);var s=document.createTextNode(" Carrinho");i.appendChild(s),i.classList.add("woo-better-product-name");var p=document.createElement("p"),m=document.createElement("img");m.src=c.details_icon.quantity,m.alt="Quantidade",m.classList.add("woo-better-icon"),m.classList.add(c.iconColor||"black-icon"),p.appendChild(m);var b=document.createTextNode(" Quantidade: ".concat(e.quantity));p.appendChild(b),p.classList.add("woo-better-product-quantity");var y=document.createElement("div");y.classList.add("woo-better-shipping-methods");var f=document.createElement("p"),h=document.createElement("img");h.src=c.icon,h.alt="Entrega",h.classList.add("woo-better-icon"),h.classList.add(c.iconColor||"black-icon"),f.appendChild(h);var v=document.createTextNode(" Métodos de Entrega:");f.appendChild(v),y.appendChild(f);var g=document.createElement("ul");g.classList.add("woo-better-shipping-list"),t.forEach(function(e){var t=document.createElement("li");t.innerHTML="<strong>".concat(e.currency," ").concat(parseFloat(e.cost).toFixed(e.currency_minor_unit).replace(".",","),"</strong> - ").concat(e.label),g.appendChild(t)}),y.appendChild(g),a.appendChild(i),a.appendChild(p),a.appendChild(y);var w=function(e,t){var n=document.createElement("div");n.classList.add("woo-better-current-postcode-block");var o=document.createElement("div");o.classList.add("woo-better-toggle-postcode-wrapper");var r=document.createElement("button");r.type="button",u(r,"up","Esconder detalhes de entrega"),r.classList.add("woo-better-toggle-button");var a=document.createElement("span");a.innerHTML="<strong>CEP</strong>: ".concat(e),a.classList.add("woo-better-current-postcode-text"),r.addEventListener("click",function(){var e=document.querySelector(".woo-better-content-block");e&&(e.classList.contains("expanded")?(e.style.height="".concat(e.scrollHeight,"px"),requestAnimationFrame(function(){e.style.height="0"}),e.classList.remove("expanded"),r.innerHTML="",u(r,"down","Exibir detalhes de entrega")):(e.style.height="".concat(e.scrollHeight,"px"),e.classList.add("expanded"),r.innerHTML="",u(r,"up","Esconder detalhes de entrega"),e.addEventListener("transitionend",function(){e.classList.contains("expanded")&&(e.style.height="".concat(e.scrollHeight,"px"))},{once:!0})))}),o.appendChild(r),o.appendChild(a);var c=document.createElement("button");return c.type="button",c.textContent="Alterar",c.classList.add("woo-better-change-postcode-button"),c.addEventListener("click",function(){var e=document.querySelector(".woo-better-info-block");e&&(e.style.display="none"),t.style.display="block"}),n.appendChild(o),n.appendChild(c),n}(n,o);return r.appendChild(w),r.appendChild(a),r}(s.product,s.shipping_rates,s.postcode,a);if(r.appendChild(a),r.appendChild(b),o.insertAdjacentElement("afterend",r),l=function(){var e="woo_better_postcode",t=localStorage.getItem(e);if(t){var n=JSON.parse(t);if(Date.now()-n.timestamp<2592e6)return n;localStorage.removeItem(e)}return null}()){var y=document.querySelector(".woo-better-button-current-style"),f=document.querySelector(".woo-better-input-current-style");y&&f&&(f.value=l.postcode||"",y.click())}t.disconnect()}}})}).observe(document.body,{childList:!0,subtree:!0})})})();